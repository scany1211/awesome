---

layout: post
title: 学习mesh
category: 技术
tags: Mesh
keywords: mosn detail

---

## 前言

* TOC
{:toc}

[服务网格在百度核心业务大规模落地实践](https://mp.weixin.qq.com/s/sQvs03oDeZsuX-TTz9qg8g) 具体细节倒还好，比较有价值的就是提出了落地图景和理想化状态。

![](/public/upload/mesh/mesh_arch.png)

考虑的问题
1. 技术选型
1. 性能问题和资源问题
    1. 网络接入：iptables 还是直通
    2. 性能优化：一跳还是两跳，面向失败设计，Service Mesh 可以 fallback 为直连模式。
    3. Sidecar自身会消耗资源，增加业务的成本。
    4. 随着Sidecar规模的增长，开源的控制平面计算开销变大，导致Mesh配置下发时间变长，甚至无法工作。
1. 改造成本
    3. 各种各样的微服务框架网格化改造和适配
    4. 各种各样的通信协议支持

![](/public/upload/mesh/mesh_process.png)

享受网格场景场景化能力

1. 服务治理策略
    1. 延迟感知负载均衡，基于Server 响应时间进行流量调度，尽量多调度给延迟低的Server
    2. 错误码调权，基于自定义错误码进行Server 调权，加速异常Server 节点的驱逐
    3. 备份重试，通过定时触发备份重试请求优化长度，提高可用性
    4. 动态备份重试，按分位值动态设置备份重试请求触发时间，支持备份重试请求熔断，防止重试风暴。
    5. 流量丢弃/全局流控，在线实施配置流量丢弃比例，摘除下游，提供统一流控预案
    6. 超时透传，实时透传上游超时给下游，帮助业务实现动态TTL机制
2. trace 平台和监控平台
3. 自动止损 ==> 稳定性预案平台， 根据监控平台的指标异常实时调参，执行流量降级、切机房、切流等 ==> 反馈到监控平台 ==> 稳定性预案平台继续调参， 实现闭环
4. 混沌工程
5. 系统容量评估（压测）

![](/public/upload/mesh/mesh_apply.png)

通过接入Mesh服务网格得到的一些启示：
1. 服务网格不是微服务治理的银弹
2. 完全无入侵的，支持所有协议，所有框架和所有治理策略的 Mesh 方案是不存在的
3. 大规模工业化落地的平滑、稳定可控接入方案，涉及到大量对已有服务治理组件的兼容升级和改造
4. 服务网格确实实现了业务逻辑和服务治理架构的解耦，解锁了很多新能力
5. 服务网格结合可观测、故障止损、混沌工程，容量管理等场景化，才能发挥出最大价值


